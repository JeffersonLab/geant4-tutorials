<h3><a  id=g4SbyS>Step-by-step Compilation</a></h3>

<h4>Code compilation dependencies</h4>

With its basic installation options Geant4 Version <label name="g4version"></label> does not
have external dependencies, but to configure the compilation and installation
process <a href="http://www.cmake.org">cmake</a> is needed.<br/>

The role of cmake is to automatically create
<i>Makfiles</i> (or project files for IDEs) based on
options that can be specified based on your own environments.<br/><br/>

We will show how to use cmake via command line options, but a
menu-based version of cmake exists (type <i>ccmake</i> instad of
<i>cmake</i>) and for some platforms also a GUI is available
(<i>cmake-gui</i>). Geant4 Version <label name="g4version"></label> requires cmake version at least 3.16.<br/>

Geant4 version <label name="g4version"></label> contains <a href="https://en.wikipedia.org/wiki/C%2B%2B11">c++11</a>
code, this mean that the compiler needs to support this standard.
With recent versions of Linux this is the default,
but you may need to manually install and setup a compiler in some cases.<br/>
Refer to the <a href="http://geant4-userdoc.web.cern.ch/geant4-userdoc/UsersGuides/InstallationGuide/html/index.html">Geant4 installation guide</a>
for additional information, including the list of supported compilers.


<h4>Visualization and GUI</h4>
We will also describe how to
setup and use the interactive graphical user interface (GUI) based on
<a href="https://qt.io">Qt</a>. This is an optional
component. We use Qt version 5.6.
Many Linux distributions already
have a pre-installed version of Qt. It is relatively easy to
manually install Qt on a Linux or Mac system, but we will not cover
this step in this tutorial. This component is optional, if
you do not want to use Qt simply skip the Qt options during
configuration. <b>None of exercises require GUI interfaces to be completed.</b><br/>
If you do not have Qt or do not want to use it, the examples in
this tutorial will fall back to simple OpenGL graphics. In such a case
to enable OpenGL graphics, use
<b>-DGEANT_USE_OPENGL_X11=ON</b> when configuring G4 with
<i>cmake</i>. While for Linux this should not be a problem, it could
have issues on Mac systems. If this fail, contact us.


<h4>Multi-threading</h4>
Starting with Geant4 Version 11 series, we introduced event level parallelism via
tasking mechanism. This means that we will develop a parallel application
that will simulate events using all available cores of your machine.
This is an optional component: we will show here how to turn it
on, but if you do not want to enable MT you can still follow the exercises
as they are, since the code is also compatible with the sequential
version of Geant4.<br/>



<h4>Step 0: Obtain the Geant4 code</h4>
After downloading and un-packing Geant4 tarball
(<code>geant4-v11.2.0.tar.gz</code>) in an empty working
directory, you also need to
create <i>build</i> and <i>install</i> directories where the compilation of Geant4 is
performed, and resulted Geant4 libraries and related scripts are installed, respectively: cmake uses <a href="https://gitlab.kitware.com/cmake/community/-/wikis/FAQ">out of source builds</a>.


<h4>Step 1: Configuration</h4><br/>
In the following we assume you are using a Linux machine. For Mac users there
are little differences,
except that you will rely on the system compiler (clang) and cannot set an
alternative compiler (in an easy way).<br/><br/>
Let's configure Geant4:<br/><br/>

<codeblock>
	$ cd &lt;tutorial&gt;<br/>
	$ wget http://cern.ch/geant4-data/releases/geant4-v11.2.0.tar.gz<br/>
	$ tar xf geant4*.tar.gz<br/>
	$ ls<br/>
	geant4-v11.2.0 geant4-v11.2.0.tar.gz<br/>
	$ mkdir build install<br/>
	$ ls<br/>
	build geant4-v11.2.0 geant4-v11.2.0.tar.gz install<br/>
	$ cd build<br/>
	$ cmake -DCMAKE_INSTALL_PREFIX=../install
	-DGEANT4_BUILD_MULTITHREADED=ON -DGEANT4_INSTALL_DATA=ON -DGEANT4_USE_QT=ON
	-DGEANT4_USE_OPENGL_X11=ON ../geant4-v11.2.0<br/>
</codeblock>
<br/>
Note: If you do not have <i>wget</i> you may download the Geant4 tar ball from <a href="https://geant4.web.cern.ch/support/download">Geant4 download page</a>.
You may also download the source code from <a target="_new" href="https://gitlab.cern.ch/geant4/geant4/-/releases/v11.2.0">
	CERN GitLab</a> or <a target="_new" href="https://github.com/Geant4/geant4/releases">GitHub</a>.
Instead of <i>cmake</i>, you may use <i>ccmake</i> to configure build options one by one.


If you have an old version of Linux with a default compiler with a version &lt;4.8.2,
type <code>gcc --version</code> to get the compiler version, you need to have installed
an alternative more recent compiler. For example if you have a CentOS 6 or Scientific Linux 6
distributions you need to manually install a recent compiler. After doing that you need
to prepend to the <code>cmake</code> line: <code>CC=gcc CXX=g++</code> and make sure that
gcc and g++ binaries are the correct one.<br/>
Replace <code>gcc</code> and <code>g++</code> with your alternative compiler if you have one
and you want to use it
(e.g. <code>icc</code> and <code>icpc</code> for Intel C compiler).<br/>
If everything goes as expected <Code>cmake</code> will work
few seconds on the configuration. The last lines should read:<br/><br/>
<code>
	-- Configuring done<br/>
	-- Generating done<br/>
	-- Build files have been written to: &lt;some-directory&gt;/build
</code><br/><br/>


Some notes:
<ul>
	<li> If you do not want to use Qt, remove the <code>-DGEANT4_USE_QT=ON</code> option. If you do not want
		multi-threaded support remove also the corresponding option.
	</li>
	<li> If you disable Qt it is recommended to leave OpenGL with:
		<code>-DGEANT4_USE_OPENGL_X11=ON</code>.
	</li>
	<li>
		With Mac OS X you need XQuartz to be properly installed to use OPENGL_X11 option.
	</li>
	<li>
		If you have installed Qt manually, and you are using Qt 5.6, you may need to
		add: <code>-DCMAKE_PREFIX_PATH=&lt;where-qt-is-installed&gt;/5.6/gcc_64</code>
		to cmake options if Qt is not found (you may need to adjust the path).
	</li>
	<li>Refer to the <a
			href="http://geant4-userdoc.web.cern.ch/geant4-userdoc/UsersGuides/InstallationGuide/html/index.html">installation
		manual</a> for a complete list of installation options. There are many more options available.
	</li>
	<li>If you already have installed Geant4 databases somewhere in your
		system, you can avoid downloading automatically the library by adding
		<code>-DGEANT4_INSTALL_DATADIR=<i>where-the-dbs-are</i></code>.
	</li>
	<li>If you receive an error about
		EXPAT libraries, add <code>-DGEANT4_USE_SYSTEM_EXPAT=OFF</code>.
	</li>
	<li>If you want to use an already installed version of CLHEP,
		instead of using the Geant4 internal one, you can specify that via the option:
		<code>-DGEANT4_USE_SYSTEM_CLHEP=OFF</code>. You may need to specify
		where to find CLHEP (see installation manuals).
	</li>
	<li>If you want to use an IDE you can specify the
		option <code>-G&lt;ide-type-goes-here&gt;</code> (run cmake without options to see a list of
		supported IDEs on your system, for example on Mac OS X with Xcode:
		<code>cmake -GXcode [...]</code>, for KDevelop3 support:
		<code>-GKDevelop3</code>, for Eclipse: <code>cmake -G"Eclipse CDT4 - Unix Makefiles" [...]</code>. In such a case instead
		of makefiles cmake will create project files for that IDE.
	</li>
</ul>


<h4>Step 2: Compilation</h4>
Compile Geant4, on a multi-core system with <i>N</i> cores you can
substantially speedup compilation.<br/><br/>
<TABLE border=1>
	<TBODY>
	<TR>
		<TD><code>
			$ cd &lt;tutorial&gt;<br/>
			$ make -j <i>2</i> #or gmake -j <i>2</i><br/>
			$ make install<br/>
		</code></TD>
	</TR>
	</TBODY>
</TABLE>
<br/>
<b>Note</b>: replace <i>2</i> with the integer representing the
number of cores of your machine. If not sure use 2.<br/>
<b>Note</b>: you can have a verbose compilation (for example to see the exact
compilation options) using <code>make VERBOSE=1 -j <i>2</i></code>.<br/>


After Geant4 has been compiled and installed the content of the
&lt;tutorial&gt;/install directory should contain the directories: <code>bin share include lib[64]</code>.<br/>
The <code>include</code> directory contains a sub-directory
(<code>Geant4</code>) where all the <code>.hh</code> files are
located. The directory <code>lib[64]</code> contains all Geant4
libraries and a sub-directory: <code>Geant4-11.2.0</code>, this
contains cmake files specific to Geant4 (they are used to compile an
application via cmake that <i>uses</i> Geant4).

